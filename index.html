<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>StartupInsight AI Test</title>
<style>
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    max-width: 720px;
    margin: 2rem auto;
    padding: 1.5rem 2rem;
    background: #f9f9f9;
    color: #222;
    box-shadow: 0 4px 12px rgb(0 0 0 / 0.1);
    border-radius: 10px;
  }
  header {
    background: #2c3e50;
    color: white;
    padding: 15px 25px;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 600;
    font-size: 1.4rem;
  }
  #status {
    font-weight: 700;
    padding: 3px 10px;
    border-radius: 5px;
    background: gray;
    color: white;
    min-width: 90px;
    text-align: center;
    user-select: none;
  }
  section {
    margin-top: 2.5rem;
  }
  h2 {
    margin-bottom: 0.8rem;
    color: #34495e;
  }
  button {
    padding: 12px 26px;
    font-size: 16px;
    background-color: #3498db;
    border: none;
    color: white;
    border-radius: 7px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  button:disabled {
    background-color: #95a5a6;
    cursor: not-allowed;
  }
  button:hover:not(:disabled) {
    background-color: #2980b9;
  }
  #response {
    margin-top: 20px;
    min-height: 100px;
    background: white;
    padding: 18px 22px;
    border-radius: 8px;
    box-shadow: 0 1px 6px rgb(0 0 0 / 0.1);
    white-space: pre-wrap;
    font-family: Consolas, monospace;
    font-size: 15px;
    color: #2c3e50;
  }
  form > div {
    margin-top: 15px;
  }
  label {
    font-weight: 600;
    display: block;
    margin-bottom: 6px;
    color: #2c3e50;
  }
  input[type="text"], textarea {
    width: 100%;
    padding: 10px 12px;
    font-size: 15px;
    border: 1.8px solid #bdc3c7;
    border-radius: 6px;
    transition: border-color 0.3s ease;
  }
  input[type="text"]:focus, textarea:focus {
    border-color: #3498db;
    outline: none;
  }
  /* Loader spinner */
  .loader {
    display: inline-block;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #3498db;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    animation: spin 1s linear infinite;
    vertical-align: middle;
    margin-left: 10px;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>
</head>
<body>

<header>
  <div>StartupInsight AI Test</div>
  <div>Backend Status: <span id="status" title="Backend connectivity status">Checking...</span></div>
</header>

<section>
  <button id="checkStatusBtn" aria-label="Check backend status">Check Backend Status</button>
</section>

<section>
  <h2>Get AI Fact</h2>
  <button id="aiFactBtn" aria-label="Generate AI Fact">Generate AI Fact</button>
</section>

<section>
  <h2>Ask a Question from URL</h2>
  <form id="askForm" autocomplete="off">
    <div>
      <label for="question">Question:</label>
      <input type="text" id="question" name="question" placeholder="Type your question here" required />
    </div>
    <div>
      <label for="url">URL to scrape:</label>
      <input type="text" id="url" name="url" placeholder="https://example.com" required />
    </div>
    <button type="submit" aria-label="Submit question and URL">Ask</button>
  </form>
</section>

<section>
  <h2>Response</h2>
  <div id="response" aria-live="polite" aria-atomic="true">AI response will appear here...</div>
</section>

<script>
  const backendBaseURL = 'https://startupinsight-backend.onrender.com';

  const statusEl = document.getElementById('status');
  const responseEl = document.getElementById('response');
  const aiFactBtn = document.getElementById('aiFactBtn');
  const checkStatusBtn = document.getElementById('checkStatusBtn');
  const askForm = document.getElementById('askForm');

  // Update backend status UI
  function updateStatus(online) {
    if (online) {
      statusEl.textContent = 'Online';
      statusEl.style.backgroundColor = '#27ae60';
      statusEl.style.color = '#fff';
    } else {
      statusEl.textContent = 'Offline';
      statusEl.style.backgroundColor = '#c0392b';
      statusEl.style.color = '#fff';
    }
  }

  // Check backend status endpoint (/status)
  async function checkBackendStatus() {
    updateStatus(false);
    responseEl.textContent = 'Checking backend status...';
    try {
      const res = await fetch(backendBaseURL + '/status');
      if (!res.ok) throw new Error('Status response not OK');
      const data = await res.json();
      if (data.status === 'online') {
        updateStatus(true);
        responseEl.textContent = 'Backend is online and ready.';
      } else {
        updateStatus(false);
        responseEl.textContent = 'Backend responded but status unknown.';
      }
    } catch (e) {
      updateStatus(false);
      responseEl.textContent = 'Error connecting to backend: ' + e.message;
    }
  }

  checkStatusBtn.addEventListener('click', checkBackendStatus);

  // Utility: show loading spinner inside button
  function setLoading(button, loading = true) {
    if (loading) {
      button.disabled = true;
      button.innerHTML = `Processing<span class="loader"></span>`;
    } else {
      button.disabled = false;
      if (button.id === 'aiFactBtn') button.textContent = 'Generate AI Fact';
      if (button.id === 'checkStatusBtn') button.textContent = 'Check Backend Status';
    }
  }

  // Handle AI Fact button
  aiFactBtn.addEventListener('click', async () => {
    responseEl.textContent = '';
    setLoading(aiFactBtn, true);
    try {
      const res = await fetch(backendBaseURL + '/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt: 'Tell me a random AI fact.' }),
      });
      if (!res.ok) throw new Error('Response not OK');
      const data = await res.json();
      if (data.error) throw new Error(data.error);
      responseEl.textContent = data.output || 'No output returned.';
    } catch (e) {
      responseEl.textContent = 'Error: ' + e.message;
    } finally {
      setLoading(aiFactBtn, false);
    }
  });

  // Handle Ask form submit
  askForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    responseEl.textContent = '';
    setLoading(askForm.querySelector('button[type="submit"]'), true);

    const question = askForm.question.value.trim();
    const url = askForm.url.value.trim();

    if (!question || !url) {
      responseEl.textContent = 'Please fill both question and URL fields.';
      setLoading(askForm.querySelector('button[type="submit"]'), false);
      return;
    }

    try {
      const res = await fetch(backendBaseURL + '/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question, url }),
      });
      if (!res.ok) {
        const errData = await res.json().catch(() => null);
        throw new Error(errData?.error || 'Response not OK');
      }
      const data = await res.json();
      if (data.error) throw new Error(data.error);

      responseEl.textContent = 
        `Q: ${data.question}\nA: ${data.answer}\nConfidence: ${(data.score * 100).toFixed(2)}%`;
    } catch (e) {
      responseEl.textContent = 'Error: ' + e.message;
    } finally {
      setLoading(askForm.querySelector('button[type="submit"]'), false);
    }
  });

  // Auto check backend on page load
  checkBackendStatus();
</script>

</body>
</html>
